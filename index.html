<script>
    // ... (이전 코드와 동일한 변수 설정) ...

    async function init() {
        try {
            // 1. 데이터 먼저 확실히 가져오기!
            const response = await fetch('data/SummonerSpellData.csv');
            if (!response.ok) throw new Error("파일을 찾을 수 없어!");
            
            const dataText = await response.text();
            const rows = dataText.split('\n').filter(r => r.trim() !== '').map(r => r.split(','));

            // 2. 맵을 먼저 다 채우기!
            rows.forEach(row => {
                const name = row[0].trim();
                if (name && !name.includes('가속') && !name.includes('퀘스트') && spellFileMap[name]) {
                    spellDataMap[name] = row;
                }
            });

            // 3. 데이터가 '확실히' 있을 때만 그리드 생성 시작!
            if (Object.keys(spellDataMap).length > 0) {
                createTimerGrid();
            } else {
                console.error("데이터 맵이 비어있어, 오빠!");
            }
        } catch (e) { 
            container.innerText = "데이터 로드 실패! 경로를 확인해줘 오빠!";
            console.error(e);
        }
    }

    function createTimerGrid() {
        container.innerHTML = '';
        for (let i = 0; i < rowsCount; i++) {
            // ... (행 생성 로직) ...

            // [핵심] 여기서 upd()를 호출할 때 데이터가 있는지 한 번 더 확인!
            const upd = () => { 
                if (spellDataMap[s1.value] && spellDataMap[s2.value]) {
                    updateBtn(i, 0, s1.value, boost.value); 
                    updateBtn(i, 1, s2.value, boost.value); 
                }
            };

            // 버튼이 처음부터 나오게 강제 실행!
            setTimeout(upd, 0); // 브라우저가 요소를 다 만든 직후 실행하게 예약해!
        }
    }
</script>
