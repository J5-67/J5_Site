<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Manager v2</title>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: #1a1a1a;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .row {
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: #333;
            padding: 10px;
            border-radius: 8px;
        }
        .selectors-group {
            display: flex;
            gap: 5px;
        }
        .spell-selector, .boost-selector {
            background-color: #222;
            color: #fff;
            border: 1px solid #555;
            padding: 5px;
            border-radius: 5px;
            font-size: 0.85rem;
            cursor: pointer;
        }
        .spell-selector { width: 80px; }
        .boost-selector { width: 130px; }

        .timer-unit {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
        }
        .time-display {
            font-size: 1.5rem;
            font-weight: bold;
            width: 55px;
            text-align: center;
            color: #00ffcc;
        }
        button {
            width: 44px;
            height: 44px;
            padding: 0;
            cursor: pointer;
            background-color: #444;
            border: 2px solid #666;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        button img { width: 100%; height: 100%; object-fit: cover; }
        button:hover { border-color: #00ffcc; }
        button:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <div class="container" id="time-container"></div>

    <script>
        const rowsCount = 5;
        let timeStates = Array.from({ length: 5 }, () => [0, 0]);
        let intervals = Array.from({ length: 5 }, () => [null, null]);
        let spellDataMap = {};

        const spellFileMap = {
            '점멸': 'flash', '유체화': 'ghost', '회복': 'heal', '탈진': 'exhaust',
            '방어막': 'barrier', '점화': 'ignite', '정화': 'cleanse', '순간이동': 'teleport'
        };

        const container = document.getElementById('time-container');

        async function init() {
            try {
                const response = await fetch('data/SummonerSpellData.csv');
                const data = await response.text();
                const rows = data.split('\n').filter(row => row.trim() !== '').map(row => row.split(','));

                rows.forEach(row => {
                    if (row.length > 2) spellDataMap[row[0].trim()] = row;
                });

                createTimerGrid();
            } catch (error) {
                console.error("CSV 로드 실패:", error);
                container.innerText = "데이터를 불러올 수 없어 오빠 ㅠㅠ";
            }
        }

        function formatTime(sec) { return sec.toString().padStart(3, '0'); }

        function startTimer(r, s, sec) {
            if (intervals[r][s]) clearInterval(intervals[r][s]);
            timeStates[r][s] = sec;
            const display = document.getElementById(`time-${r}-${s}`);
            display.innerText = formatTime(sec);

            intervals[r][s] = setInterval(() => {
                if (timeStates[r][s] > 0) {
                    timeStates[r][s]--;
                    display.innerText = formatTime(timeStates[r][s]);
                } else {
                    clearInterval(intervals[r][s]);
                    intervals[r][s] = null;
                }
            }, 1000);
        }

        function createTimerGrid() {
            container.innerHTML = '';
            for (let i = 0; i < rowsCount; i++) {
                const row = document.createElement('div');
                row.className = 'row';

                // 1. 선택 그룹 (주문1, 주문2, 가속)
                const selectors = document.createElement('div');
                selectors.className = 'selectors-group';

                const s1 = createSelect(i, 0);
                const s2 = createSelect(i, 1);
                const boost = document.createElement('select');
                boost.className = 'boost-selector';
                boost.id = `boost-${i}`;

                const options = i === 2 
                    ? [['2', '기본'], ['3', '신발'], ['5', '미장'], ['6', '신발+우통'], ['7', '미장+우통']]
                    : [['2', '기본'], ['3', '신발'], ['4', '우통'], ['6', '신발+우통']];

                options.forEach(opt => {
                    const o = document.createElement('option');
                    o.value = opt[0]; o.innerText = opt[1];
                    boost.appendChild(o);
                });

                selectors.append(s1, s2, boost);

                // 2. 타이머 유닛 (1, 2)
                const timer1 = createTimerUnit(i, 0);
                const timer2 = createTimerUnit(i, 1);

                row.append(selectors, timer1, timer2);
                container.appendChild(row);

                // 초기화 이벤트
                const update = () => {
                    updateButton(i, 0, s1.value, boost.value);
                    updateButton(i, 1, s2.value, boost.value);
                };
                s1.onchange = s2.onchange = boost.onchange = update;
                update();
            }
        }

        function createSelect(r, s) {
            const sel = document.createElement('select');
            sel.className = 'spell-selector';
            Object.keys(spellDataMap).forEach(name => {
                const opt = document.createElement('option');
                opt.value = name; opt.innerText = name;
                if(s === 0 && name === '점멸') opt.selected = true;
                if(s === 1 && name === '유체화') opt.selected = true;
                sel.appendChild(opt);
            });
            return sel;
        }

        function createTimerUnit(r, s) {
            const div = document.createElement('div');
            div.className = 'timer-unit';
            div.innerHTML = `<span class="time-display" id="time-${r}-${s}">000</span><div id="btn-container-${r}-${s}"></div>`;
            return div;
        }

        function updateButton(r, s, spellName, boostIdx) {
            const cont = document.getElementById(`btn-container-${r}-${s}`);
            cont.innerHTML = '';
            const data = spellDataMap[spellName];
            const sec = parseInt(data[boostIdx]);

            const btn = document.createElement('button');
            const img = document.createElement('img');
            img.src = `images/${spellFileMap[spellName]}.png`;
            btn.onclick = () => startTimer(r, s, sec);
            btn.appendChild(img);
            cont.appendChild(btn);
        }

        init();
    </script>
</body>
</html>
